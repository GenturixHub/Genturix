<!doctype html>
<html lang="es">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
        
        <!-- PWA Meta Tags -->
        <meta name="theme-color" content="#7C3AED" />
        <meta name="background-color" content="#05050A" />
        <meta name="description" content="GENTURIX - Plataforma de Seguridad y Emergencias. Protege tu comunidad. $1/usuario/mes" />
        
        <!-- iOS PWA Support -->
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="apple-mobile-web-app-title" content="GENTURIX" />
        <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
        
        <!-- Android/Chrome -->
        <link rel="manifest" href="/manifest.json" />
        
        <!-- Favicon -->
        <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png" />
        
        <!-- Preconnect for performance -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        
        <title>GENTURIX - Seguridad y Emergencias</title>
        
        <style>
            /* Critical CSS for fast first paint */
            body {
                margin: 0;
                background-color: #05050A;
                color: #FAFAFA;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
            
            /* iOS safe area support */
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
            }
            
            /* PWA Install prompt styling */
            #pwa-install-prompt {
                display: none;
                position: fixed;
                bottom: 80px;
                left: 16px;
                right: 16px;
                background: linear-gradient(135deg, #7C3AED 0%, #9333EA 100%);
                color: white;
                padding: 16px;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(124, 58, 237, 0.4);
                z-index: 9998;
                animation: slideUp 0.3s ease-out;
            }
            
            @keyframes slideUp {
                from { transform: translateY(100px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            
            /* Loading state */
            #root:empty::after {
                content: '';
                display: block;
                width: 40px;
                height: 40px;
                margin: 100px auto;
                border: 3px solid #1E293B;
                border-top-color: #7C3AED;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }
            
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
        </style>
    </head>
    <body>
        <noscript>
            <div style="padding: 20px; text-align: center;">
                <h1>GENTURIX</h1>
                <p>Necesitas habilitar JavaScript para usar esta aplicación.</p>
            </div>
        </noscript>
        
        <div id="root"></div>
        
        <!-- PWA Install Prompt -->
        <div id="pwa-install-prompt">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <strong>Instalar GENTURIX</strong>
                    <p style="margin: 4px 0 0; font-size: 14px; opacity: 0.9;">Acceso rápido a emergencias</p>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button id="pwa-install-dismiss" style="background: transparent; border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer;">
                        Luego
                    </button>
                    <button id="pwa-install-btn" style="background: white; color: #7C3AED; border: none; padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        Instalar
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Service Worker Registration -->
        <script>
            // Register Service Worker
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('/service-worker.js')
                        .then(function(registration) {
                            console.log('GENTURIX SW registered:', registration.scope);
                        })
                        .catch(function(error) {
                            console.log('GENTURIX SW registration failed:', error);
                        });
                });
            }
            
            // PWA Install Prompt
            let deferredPrompt;
            const installPrompt = document.getElementById('pwa-install-prompt');
            const installBtn = document.getElementById('pwa-install-btn');
            const dismissBtn = document.getElementById('pwa-install-dismiss');
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Show install prompt after 30 seconds or if user has been active
                setTimeout(() => {
                    if (deferredPrompt && !localStorage.getItem('pwa-dismissed')) {
                        installPrompt.style.display = 'block';
                    }
                }, 30000);
            });
            
            if (installBtn) {
                installBtn.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log('PWA install outcome:', outcome);
                        deferredPrompt = null;
                        installPrompt.style.display = 'none';
                    }
                });
            }
            
            if (dismissBtn) {
                dismissBtn.addEventListener('click', () => {
                    installPrompt.style.display = 'none';
                    localStorage.setItem('pwa-dismissed', 'true');
                });
            }
            
            // Hide prompt if already installed
            window.addEventListener('appinstalled', () => {
                installPrompt.style.display = 'none';
                deferredPrompt = null;
            });
        </script>
        
        <!-- PostHog Analytics (with comprehensive error suppression) -->
        <script>
            // Suppress PostHog-related console errors
            (function() {
                var originalConsoleError = console.error;
                console.error = function(...args) {
                    var message = args.join(' ');
                    // Suppress PostHog-related errors
                    if (message.includes('posthog') || 
                        message.includes('PostHog') || 
                        message.includes('array.js') ||
                        message.includes('us.i.posthog.com')) {
                        return; // Silently ignore
                    }
                    return originalConsoleError.apply(console, args);
                };
            })();
            
            !(function (t, e) {
                var o, n, p, r;
                e.__SV ||
                    ((window.posthog = e),
                    (e._i = []),
                    (e.init = function (i, s, a) {
                        function g(t, e) {
                            var o = e.split(".");
                            2 == o.length && ((t = t[o[0]]), (e = o[1])),
                                (t[e] = function () {
                                    t.push([e].concat(Array.prototype.slice.call(arguments, 0)));
                                });
                        }
                        ((p = t.createElement("script")).type = "text/javascript"),
                            (p.crossOrigin = "anonymous"),
                            (p.async = !0),
                            (p.src = s.api_host.replace(".i.posthog.com", "-assets.i.posthog.com") + "/static/array.js"),
                            (p.onerror = function() { /* Silent fail */ }),
                            (r = t.getElementsByTagName("script")[0]).parentNode.insertBefore(p, r);
                        var u = e;
                        for (
                            void 0 !== a ? (u = e[a] = []) : (a = "posthog"),
                                u.people = u.people || [],
                                u.toString = function (t) {
                                    var e = "posthog";
                                    return "posthog" !== a && (e += "." + a), t || (e += " (stub)"), e;
                                },
                                u.people.toString = function () {
                                    return u.toString(1) + ".people (stub)";
                                },
                                o = "init capture".split(" "),
                                n = 0;
                            n < o.length;
                            n++
                        )
                            g(u, o[n]);
                        e._i.push([i, s, a]);
                    }),
                    (e.__SV = 1));
            })(document, window.posthog || []);
            
            try {
                posthog.init("phc_xAvL2Iq4tFmANRE7kzbKwaSqp1HJjN7x48s3vr0CMjs", {
                    api_host: "https://us.i.posthog.com",
                    person_profiles: "identified_only",
                    autocapture: false,
                    capture_pageview: false,
                    disable_session_recording: true,
                    opt_out_capturing_by_default: false
                });
            } catch (e) {
                // Silent fail - analytics are non-critical
            }
        </script>
    </body>
</html>
